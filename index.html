<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Mood Light Controller</title>
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 50px; }
    #loginBox { display: block; }
    #controlBox { display: none; }
  </style>
</head>
<body>
  <!-- LOGIN SCREEN -->
  <div id="loginBox">
    <h1>Login</h1>
    <input type="text" id="username" placeholder="Username"><br><br>
    <input type="password" id="password" placeholder="Password"><br><br>
    <button onclick="login()">Login</button>
    <p id="loginMsg"></p>
  </div>

  <!-- CONTROLLER -->
  <div id="controlBox">
    <h1>Mood Light Controller</h1>
    <input type="color" id="colorPicker" value="#ff0000"><br><br>
    <button id="sendBtn">Send Color</button>
    <p id="status">Not connected</p>
  </div>

  <script>
    // === SIMPLE LOGIN ===
    const validUser = "admin";
    const validPass = "moodlight123";

    function login() {
      const u = document.getElementById("username").value;
      const p = document.getElementById("password").value;
      if (u === validUser && p === validPass) {
        document.getElementById("loginBox").style.display = "none";
        document.getElementById("controlBox").style.display = "block";
        document.getElementById("status").innerText = "Connecting to MQTT...";
        connectMQTT();
      } else {
        document.getElementById("loginMsg").innerText = "‚ùå Wrong username or password!";
      }
    }

    // === MQTT CONNECTION ===
    let client;

    function connectMQTT() {
      const options = {
        username: "beebo",    // HiveMQ username
        password: "Beebosynth1",    // HiveMQ password
        protocol: "wss",
        clientId: "webclient-" + Math.random().toString(16).substr(2, 8)
      };

      client = mqtt.connect("wss://e6872d409e4d4e09a08d5a244e1b038d.s1.eu.hivemq.cloud:8884/mqtt", options);

      client.on("connect", () => {
        document.getElementById("status").innerText = "‚úÖ Connected!";
        console.log("Connected to MQTT broker");
      });

      client.on("error", (err) => {
        document.getElementById("status").innerText = "‚ùå MQTT connection error";
        console.error("MQTT error:", err);
      });
    }

    // === SEND COLOR BUTTON ===
    document.getElementById("sendBtn").addEventListener("click", () => {
      if (!client || !client.connected) {
        document.getElementById("status").innerText = "‚ùå Not connected!";
        return;
      }

      const color = document.getElementById("colorPicker").value; // #RRGGBB
      client.publish("moodlight/color", color);
      document.getElementById("status").innerText = "üì§ Sent: " + color;
    });
  </script>
</body>
</html>
